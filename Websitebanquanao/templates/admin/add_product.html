{% extends "admin/base_admin.html" %}

{% block page_title %}Thêm sản phẩm{% endblock %}

{% block title %}Thêm sản phẩm - Admin{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-2xl">
    <h1 class="text-3xl font-bold mb-6">Thêm sản phẩm mới</h1>

    <div class="bg-white rounded-2xl shadow-sm p-6">
        <form method="POST" enctype="multipart/form-data" id="add-product-form">
            <div class="mb-4">
                <label class="block text-gray-700 font-semibold mb-2">Tên sản phẩm *</label>
                <input type="text" name="name" 
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" 
                       required>
            </div>

            <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Giá *</label>
                    <input type="number" name="price" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" 
                           required>
                </div>
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Giá cũ</label>
                    <input type="number" name="old_price" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 font-semibold mb-2">Danh mục *</label>
                <select name="category" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                    <option value="">-- Chọn danh mục --</option>
                    <option value="Áo thun">Áo thun</option>
                    <option value="Áo khoác">Áo khoác</option>
                    <option value="Áo sơ mi">Áo sơ mi</option>
                    <option value="Áo len">Áo len</option>
                    <option value="Quần">Quần</option>
                    <option value="Váy">Váy</option>
                    <option value="Phụ kiện">Phụ kiện</option>
                </select>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 font-semibold mb-2">Hình ảnh sản phẩm *</label>
                
                <!-- Image Upload -->
                <div class="mb-3">
                    <label class="block w-full">
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-blue-500 transition" id="upload-area">
                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
                            <p class="text-gray-600 mb-1">Nhấp để chọn ảnh hoặc kéo thả ảnh vào đây</p>
                            <p class="text-sm text-gray-500">PNG, JPG, GIF, WEBP (tối đa 16MB)</p>
                            <input type="file" name="image_file" id="image_file" accept="image/*" class="hidden" onchange="previewImage(event)">
                        </div>
                    </label>
                </div>
                
                <!-- Image Preview -->
                <div id="image-preview" class="hidden mb-3">
                    <img id="preview-img" src="" alt="Preview" class="max-w-xs rounded-lg border">
                    <button type="button" onclick="removeImage()" class="mt-2 text-red-600 hover:text-red-800">
                        <i class="fas fa-trash"></i> Xóa ảnh
                    </button>
                </div>
                
                <!-- Or use URL -->
                <div class="text-center text-gray-500 mb-2">hoặc</div>
                <input type="text" name="image" id="image_url" 
                       placeholder="Nhập URL hình ảnh (https://example.com/image.jpg)"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                <p class="text-sm text-gray-500 mt-1">Nếu không upload, bạn có thể nhập URL hình ảnh</p>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 font-semibold mb-2">Mô tả</label>
                <textarea name="description" rows="4" 
                          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                          placeholder="Mô tả chi tiết về sản phẩm..."></textarea>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 font-semibold mb-2">Số lượng tồn kho *</label>
                <input type="number" name="stock" value="0" min="0"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" 
                       required>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 font-semibold mb-2">Kích thước (phân cách bởi dấu phẩy)</label>
                <input type="text" name="sizes" value="S,M,L,XL"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                <p class="text-sm text-gray-500 mt-1">Ví dụ: S,M,L,XL hoặc 28,29,30,31,32</p>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 font-semibold mb-2">Màu sắc (phân cách bởi dấu phẩy)</label>
                <input type="text" name="colors" value="Đen,Trắng,Xám"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                <p class="text-sm text-gray-500 mt-1">Ví dụ: Đen,Trắng,Xám</p>
            </div>

            <div class="mb-6">
                <label class="flex items-center">
                    <input type="checkbox" name="featured" value="1"
                           class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <span class="ml-2 text-gray-700">Sản phẩm nổi bật (hiển thị ở trang chủ)</span>
                </label>
            </div>

            <div class="flex space-x-4">
                <button type="submit" class="flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition">
                    <i class="fas fa-plus mr-2"></i>Thêm sản phẩm
                </button>
                <a href="/admin/products" class="flex-1 bg-gray-200 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-300 transition text-center">
                    <i class="fas fa-times mr-2"></i>Hủy
                </a>
            </div>
        </form>
    </div>
</div>

<script>
// Click to open file dialog
document.getElementById('upload-area').addEventListener('click', function() {
    document.getElementById('image_file').click();
});

// Drag and drop
const uploadArea = document.getElementById('upload-area');

uploadArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadArea.classList.add('border-blue-500', 'bg-blue-50');
});

uploadArea.addEventListener('dragleave', () => {
    uploadArea.classList.remove('border-blue-500', 'bg-blue-50');
});

uploadArea.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadArea.classList.remove('border-blue-500', 'bg-blue-50');
    
    const files = e.dataTransfer.files;
    if (files.length > 0) {
        document.getElementById('image_file').files = files;
        previewImage({ target: { files: files } });
    }
});

// Preview image
function previewImage(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('preview-img').src = e.target.result;
            document.getElementById('image-preview').classList.remove('hidden');
            document.getElementById('upload-area').classList.add('hidden');
            // Clear URL input when file is selected
            document.getElementById('image_url').value = '';
        };
        reader.readAsDataURL(file);
    }
}

// Remove image
function removeImage() {
    document.getElementById('image_file').value = '';
    document.getElementById('preview-img').src = '';
    document.getElementById('image-preview').classList.add('hidden');
    document.getElementById('upload-area').classList.remove('hidden');
}

// Form validation
document.getElementById('add-product-form').addEventListener('submit', function(e) {
    const fileInput = document.getElementById('image_file');
    const urlInput = document.getElementById('image_url');
    
    if (!fileInput.files.length && !urlInput.value) {
        e.preventDefault();
        alert('Vui lòng upload hình ảnh hoặc nhập URL hình ảnh');
        return false;
    }
});
</script>
{% endblock %}
